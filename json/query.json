// Copyright Â© 2014, Canal TP and/or its affiliates. All rights reserved.
//
// LICENCE: This program is free software; you can redistribute it
// and/or modify it under the terms of the GNU Affero General Public
// License as published by the Free Software Foundation, either
// version 3 of the License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful, but
// WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
// Affero General Public License for more details.
//
// You should have received a copy of the GNU Affero General Public
// License along with this program. If not, see
// <http://www.gnu.org/licenses/>.

// note: this file is not really json, it's rust format string

{{
    "query": {{
        "filtered": {{
            "query": {{
                "bool": {{
                    "should": [
                        {{
                            "term": {{
                                "_type": {{
                                    "value": "addr",
                                    "boost": 1000
                                }}
                            }}
                        }},
                        {{
                            "match": {{
                                "name.prefix": {{
                                    "query": {query},
                                    "boost": 100
                                }}
                            }}
                        }},
                        {{
                            "match": {{
                                "name.ngram": {{
                                    "query": {query},
                                    "boost": 1
                                }}
                            }}
                        }},
                        {{
                            "function_score": {{
                                "query": {{ "match_all": {{ }} }},
                                "field_value_factor": {{
                                    "field": "weight",
                                    "modifier": "log1p",
                                    "factor": 1
                                }},
                                "boost_mode": "multiply",
                                "boost": 30
                            }}
                        }}
                    ]
                }}
            }},
            "filter": {{
                "bool": {{
                    "should": [
                        {{ "missing": {{ "field": "house_number" }} }},
                        {{
                            "query": {{
                                "match": {{ "house_number": {query} }}
                            }}
                        }}
                    ],
                    "must": [
                        {{
                            "query": {{
                                "match": {{
                                    "name.ngram": {{
                                        "query": {query},
                                        "minimum_should_match": "50%"
                                    }}
                                }}
                            }}
                        }}
                    ]
                }}
            }}
        }}
    }}
}}
